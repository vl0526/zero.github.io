<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extract Thumbnails</title>
</head>
<body>
    <h2>Trích Xuất Thumbnail</h2>
    <input type="file" id="videoInput" accept="video/*">
    <button onclick="extractThumbnails()">Tạo Thumbnail</button>
    <br><br>
    <h3>Ảnh Trích Xuất:</h3>
    <div id="thumbnails"></div>

    <script>
        function extractThumbnails() {
            const fileInput = document.getElementById("videoInput");
            if (!fileInput.files.length) {
                alert("Vui lòng chọn video!");
                return;
            }

            const file = fileInput.files[0];
            const video = document.createElement("video");
            video.src = URL.createObjectURL(file);
            video.muted = true;
            video.play();

            video.addEventListener("loadedmetadata", () => {
                const duration = Math.min(video.duration, 300); // Tối đa 5 phút (300 giây)
                const timestamps = generateTimestamps(duration, 5); // Lấy tại 0s, 5s, 10s, ...
                captureFrames(video, timestamps);
            });
        }

        function generateTimestamps(duration, interval) {
            const timestamps = [];
            for (let t = 0; t <= duration; t += interval) {
                timestamps.push(t);
            }
            return timestamps;
        }

        function captureFrames(video, timestamps) {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            canvas.width = 1280;
            canvas.height = 720;

            const thumbnailsDiv = document.getElementById("thumbnails");
            thumbnailsDiv.innerHTML = "";

            timestamps.forEach((time, index) => {
                setTimeout(() => {
                    video.currentTime = time;
                    video.addEventListener("seeked", function capture() {
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        const img = document.createElement("img");
                        img.src = canvas.toDataURL("image/jpeg");
                        img.style.maxWidth = "150px";
                        img.style.margin = "5px";
                        thumbnailsDiv.appendChild(img);
                        video.removeEventListener("seeked", capture);
                    });
                }, index * 1000);
            });
        }
    </script>
</body>
</html>
