<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Racing Game with p5.js</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #fff;
      font-family: sans-serif;
      z-index: 10;
      font-size: 18px;
    }
    #control-buttons {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    #control-buttons button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background: rgba(255,255,255,0.8);
      cursor: pointer;
    }
    #control-buttons button:active {
      background: rgba(200,200,200,0.8);
    }
  </style>
</head>
<body>
  <div id="hud">Speed: 0 km/h</div>
  <div id="control-buttons">
    <button id="btn-up">↑</button>
    <button id="btn-left">←</button>
    <button id="btn-down">↓</button>
    <button id="btn-right">→</button>
  </div>
  <!-- Import p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
  <script>
    let car;           // Vị trí, góc, tốc độ của xe
    let keys = {};     // Các phím đang được nhấn
    let groundTexture; // Texture nền cỏ

    // Tải texture trước khi setup
    function preload() {
      // Sử dụng URL của texture (đảm bảo URL hợp lệ)
      groundTexture = loadImage("https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/grasslight-big.jpg");
    }

    function setup() {
      createCanvas(windowWidth, windowHeight, WEBGL);
      textureMode(NORMAL);
      angleMode(RADIANS);
      car = {
        pos: createVector(0, 0, 0),
        angle: 0,
        speed: 0
      };
      setupButtons();
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }

    function draw() {
      background(0);
      
      // Thiết lập camera theo dõi xe
      let camX = car.pos.x - 200 * sin(car.angle);
      let camZ = car.pos.z - 200 * cos(car.angle);
      camera(camX, 100, camZ, car.pos.x, 0, car.pos.z, 0, 1, 0);
      
      ambientLight(100);
      directionalLight(255, 255, 255, 0, -1, 0);
      
      // Vẽ nền: mặt phẳng với texture cỏ
      push();
      rotateX(-HALF_PI);
      texture(groundTexture);
      plane(1000, 1000);
      pop();
      
      // Cập nhật chuyển động xe
      if (keys['ArrowUp']) {
        car.speed += 0.2;
      }
      if (keys['ArrowDown']) {
        car.speed -= 0.2;
      }
      if (keys['ArrowLeft']) {
        car.angle -= 0.03;
      }
      if (keys['ArrowRight']) {
        car.angle += 0.03;
      }
      car.speed *= 0.98; // Ma sát
      car.pos.x += car.speed * sin(car.angle);
      car.pos.z += car.speed * cos(car.angle);
      
      // Vẽ xe (box màu đỏ)
      push();
      translate(car.pos.x, 0, car.pos.z);
      rotateY(car.angle);
      fill(255, 0, 0);
      box(40, 20, 80);
      pop();
      
      // Cập nhật HUD
      select('#hud').html("Speed: " + nf(abs(car.speed * 10), 1, 2) + " km/h");
    }

    function keyPressed() {
      keys[key] = true;
    }

    function keyReleased() {
      keys[key] = false;
    }

    // Thiết lập các nút điều khiển trên màn hình
    function setupButtons() {
      let btnUp = select('#btn-up');
      let btnDown = select('#btn-down');
      let btnLeft = select('#btn-left');
      let btnRight = select('#btn-right');
      
      btnUp.mousePressed(() => { keys['ArrowUp'] = true; });
      btnUp.mouseReleased(() => { keys['ArrowUp'] = false; });
      btnDown.mousePressed(() => { keys['ArrowDown'] = true; });
      btnDown.mouseReleased(() => { keys['ArrowDown'] = false; });
      btnLeft.mousePressed(() => { keys['ArrowLeft'] = true; });
      btnLeft.mouseReleased(() => { keys['ArrowLeft'] = false; });
      btnRight.mousePressed(() => { keys['ArrowRight'] = true; });
      btnRight.mouseReleased(() => { keys['ArrowRight'] = false; });
    }
  </script>
</body>
</html>
