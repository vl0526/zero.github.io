<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extract Best Thumbnail</title>
</head>
<body>
    <h2>Tr√≠ch Xu·∫•t & Ch·ªçn ·∫¢nh ƒê·∫πp Nh·∫•t</h2>
    <input type="file" id="videoInput" accept="video/*">
    <button onclick="extractThumbnails()">T·∫°o Thumbnail</button>
    <br><br>

    <h3>To√†n B·ªô ·∫¢nh Tr√≠ch Xu·∫•t:</h3>
    <div id="thumbnails"></div>

    <h3>·∫¢nh ƒê·∫πp Nh·∫•t:</h3>
    <img id="bestThumbnail" style="display: none; max-width: 640px;">
    <br>
    <a id="downloadLink" style="display: none;" download="best_thumbnail.jpg">T·∫£i ·∫£nh ƒë·∫πp nh·∫•t</a>

    <script>
        function extractThumbnails() {
            const fileInput = document.getElementById("videoInput");
            if (!fileInput.files.length) {
                alert("Vui l√≤ng ch·ªçn video!");
                return;
            }

            const file = fileInput.files[0];
            const video = document.createElement("video");
            video.src = URL.createObjectURL(file);
            video.muted = true;
            video.play();

            video.addEventListener("loadedmetadata", () => {
                const duration = Math.min(video.duration, 300); // T·ªëi ƒëa 5 ph√∫t
                const timestamps = generateTimestamps(duration, 5); // M·ªói 5 gi√¢y
                captureFrames(video, timestamps);
            });
        }

        function generateTimestamps(duration, interval) {
            const timestamps = [];
            for (let t = 0; t <= duration; t += interval) {
                timestamps.push(t);
            }
            return timestamps;
        }

        function captureFrames(video, timestamps) {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            canvas.width = 1280;
            canvas.height = 720;

            const thumbnailsDiv = document.getElementById("thumbnails");
            thumbnailsDiv.innerHTML = "";
            const images = [];

            timestamps.forEach((time, index) => {
                setTimeout(() => {
                    video.currentTime = time;
                    video.addEventListener("seeked", function capture() {
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        const img = document.createElement("img");
                        img.src = canvas.toDataURL("image/jpeg");
                        img.style.maxWidth = "150px";
                        img.style.margin = "5px";
                        thumbnailsDiv.appendChild(img);
                        images.push(img.src);
                        video.removeEventListener("seeked", capture);

                        if (images.length === timestamps.length) {
                            findBestThumbnail(images);
                        }
                    });
                }, index * 1000);
            });
        }

        function findBestThumbnail(images) {
            let bestImage = images[0];
            let bestScore = 0;

            images.forEach((image) => {
                const score = analyzeImage(image);
                if (score > bestScore) {
                    bestScore = score;
                    bestImage = image;
                }
            });

            const bestThumbnail = document.getElementById("bestThumbnail");
            bestThumbnail.src = bestImage;
            bestThumbnail.style.display = "block";

            const downloadLink = document.getElementById("downloadLink");
            downloadLink.href = bestImage;
            downloadLink.style.display = "block";
            downloadLink.innerText = "T·∫£i ·∫£nh ƒë·∫πp nh·∫•t";
        }

        function analyzeImage(imageSrc) {
            return Math.random(); // üî• ƒê∆°n gi·∫£n h√≥a: random score (c√≥ th·ªÉ n√¢ng c·∫•p d√πng AI sau)
        }
    </script>
</body>
</html>
